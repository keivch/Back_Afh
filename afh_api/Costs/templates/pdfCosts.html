<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCOSTOS DE LA ORDEN DE TRABAJO {{ cost.work_order.quote.code }}</title>
    <style>
        @page {
            size: A4;
            margin: 15mm 20mm 20mm 20mm;
        }

        /* Rectángulo en el área superior izquierda */
        @page {
            @top-left-corner {
                content: "";
                display: block;
                width: 6mm;
                height: 15mm;
                background: #99E63C;
                border-radius: 2px;
            }
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 15px;
            color: #000;
            margin: 20px;
            position: relative;
            padding-bottom: 100px;
            line-height: 1.6;
            /* Espacio para el footer */
        }

        /* Imagen de fondo con opacidad */
        body::before {
            content: "";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            background-image: url("https://res.cloudinary.com/dp4tvthea/image/upload/v1756313054/afhlogoazul_rxcpcv.png");
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.08;
            z-index: -1;
            pointer-events: none;
        }

        .header,
        .datos-cotizacion,
        .opcion,
        .condiciones,
        .firma {
            position: relative;
            z-index: 1;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .logo {
            height: 70px;
        }

        .titulo {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        h1,
        h2,
        h3 {
            margin: 0;
            text-decoration: underline;
            margin-bottom: 15px;
            margin-top: 25px;
        }

        .datos-cotizacion,
        .condiciones,
        .firma {
            margin-top: 30px;
            margin-bottom: 25px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: rgba(255, 255, 255, 0.9);
        }

        th,
        td {
            border: 1px solid #000;
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        .item {
            text-align: left;
        }

        .total {
            font-weight: bold;
            text-align: right;
        }

        ol.tareas {
            margin-top: 15px;
            padding-left: 25px;
            margin-bottom: 20px;
        }

        ol.tareas li {
            margin-bottom: 12px;
        }

        ul {
            margin-top: 5px;
            padding-left: 25px;
            margin-bottom: 2px;
        }

        p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .firma {
            margin-top: 50px;
        }

        .tabla-cotizacion {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid black;
        }

        .tabla-cotizacion td {
            border: 1px solid black;
            padding: 8px;
            vertical-align: middle;
        }

        .logo {
            text-align: center;
            width: 18%;
        }

        .logo img {
            width: 60px;
            margin-bottom: 3px;
        }

        .estado-vigente {
            color: green;
            font-weight: bold;
            font-size: 10px;
        }

        .titulo {
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }

        .version {
            text-align: center;
            font-size: 12px;
        }

        .datos-superior,
        .datos-inferior {
            width: 28%;
            font-size: 11px;
        }

        .paginas {
            width: 12%;
            font-size: 11px;
            text-align: center;
        }

        .table-cotizacion {
            margin-bottom: 15px;
        }

        .footer {
            bottom: 0;
            right: 0;
            font-size: 12px;
            color: #000;
            background-color: rgba(255, 255, 255, 0.8);
            /* Opacidad sutil */
            padding: 8px 12px;
            text-align: right;
            z-index: 999;
            border: none;
            box-shadow: none;
            opacity: 0.6;
            /* Opacidad del footer */
        }

        .valores {
            margin-top: 0;
            /* Elimina el margen superior */
            text-align: right;
            /* Alinea el contenido a la derecha */
        }

        .valores-grid {
            display: inline-block;
            /* Para que se ajuste al contenido */
            text-align: left;
            /* Mantiene el texto alineado a la izquierda dentro del bloque */
        }

        .valores-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            /* Espaciado mínimo entre líneas */
            min-width: 200px;
            /* Ancho mínimo para mantener consistencia */
        }

        .valores-label {
            font-weight: bold;
            margin-right: 20px;
            /* Espacio entre columnas */
        }

        .valores-amount {
            text-align: right;
            flex-shrink: 0;
        }

        .total-final {
            background-color: transparent;
            color: black;
            font-weight: bold;
        }

        .total-label {
            background-color: transparent;
            color: black;
            font-weight: bold;
        }

        .diferencia-ahorro {
            color: #008000;
        }

        .diferencia-exceso {
            color: #ff0000;
        }

        .diferencia-exacta {
            color: #000000;
        }
    </style>

</head>

<body>
    <div class="decorativo-rectangulo"></div>
    <div class="table-cotizacion">
        <table class="tabla-cotizacion">
            <tr>
                <td rowspan="2" class="logo">
                    <img src={{logo_url}} alt="Logo de la empresa" />
                    <div class="estado-vigente">DOCUMENTO VIGENTE</div>
                </td>
                <td class="titulo" colspan="1">COSTOS</td>
                <td class="datos-superior">
                    <strong>Código:</strong> F-GC-05<br />
                    <strong>Fecha de Creación:</strong> 19-07-2022
                </td>
            </tr>
            <tr>
                <td class="version">RV-{{cost.work_order.quote.revision}}</td>
                <td class="datos-inferior">
                    <strong>Fecha de Revisión:</strong> 19-07-2022 <br />
                </td>
            </tr>
        </table>
    </div>

    <div class="header">
        <div class="titulo">COSTOS DE LA ORDEN DE TRABAJO N.º {{ cost.work_order.quote.code }} - {{cost.work_order.quote.revision}}</div>
    </div>

    <div>
        <p><strong>Fecha de Creación:</strong> {{fecha}}</p>
    </div>

    <div class="mensaje-explicativo" style="margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border-left: 4px solid #99E63C; font-size: 13px; line-height: 1.5;">
        <p style="margin: 0; font-weight: bold; margin-bottom: 8px;">¿Qué es este documento?</p>
        <p style="margin: 0;">
            Este documento presenta el desglose detallado de los costos asociados a la orden de trabajo N.º {{ cost.work_order.quote.code }}. 
            Los costos mostrados corresponden a los materiales, servicios y recursos necesarios para la ejecución del proyecto, 
            basados en la opción seleccionada durante el proceso de cotización. Este documento es complementario a la orden de trabajo 
            y permite el control y seguimiento de los gastos reales versus los presupuestados.
        </p>
    </div>

    <div class="opcion">
        <table>
            <thead>
                <tr>
                    <th>ITEM</th>
                    <th>DESCRIPCIÓN</th>
                    <th>UND</th>
                    <th>CANT</th>
                    <th>VALOR UNITARIO</th>
                    <th>VALOR TOTAL</th>
                </tr>
            </thead>
            <tbody>
                {% for item in opcion.items %}
                <tr>
                    <td>{{ forloop.counter }}</td> <!-- Número del ítem -->
                    <td class="item">{{ item.description }}</td>
                    <td>{{ item.units }}</td>
                    <td>{{ item.amount }}</td>
                    <td>{{ item.unit_value_formatted }}</td>
                    <td>{{ item.total_value_formatted }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="valores">
            <div class="valores-grid">
              <div class="valores-row">
                <span class="valores-label">VALOR TOTAL COSTOS:</span>
                <span class="valores-amount">{{opcion.subtotal}}</span>
              </div>
            </div>
          </div>
          
          <!-- Comparación con total de orden de trabajo -->
          <div class="comparacion-totales" style="margin-top: 20px; padding: 15px; background-color: #f0f8ff; border: 1px solid #b3d9ff; border-radius: 5px;">
            <h3 style="margin: 0 0 10px 0; font-size: 14px; color: #0066cc; text-decoration: none;">COMPARACIÓN DE TOTALES</h3>
            <div class="valores-grid" style="margin-top: 10px;">
              <div class="valores-row">
                <span class="valores-label">Total de Costos:</span>
                <span class="valores-amount">{{opcion.subtotal}}</span>
              </div>
              <div class="valores-row">
                <span class="valores-label">Total Orden de Trabajo:</span>
                <span class="valores-amount">{{total_orden}}</span>
              </div>
              <div class="valores-row" style="border-top: 1px solid #ccc; padding-top: 8px; margin-top: 8px; font-weight: bold;">
                <span class="valores-label">Diferencia:</span>
                <span class="valores-amount {% if diferencia < 0 %}diferencia-ahorro{% elif diferencia > 0 %}diferencia-exceso{% else %}diferencia-exacta{% endif %}">
                  {% if diferencia < 0 %}
                    Ahorro: {{diferencia_formateada}}
                  {% elif diferencia > 0 %}
                    Exceso: {{diferencia_formateada}}
                  {% else %}
                    $0
                  {% endif %}
                </span>
              </div>
            </div>
            <p style="margin: 10px 0 0 0; font-size: 11px; color: #666; font-style: italic;">
              {% if diferencia < 0 %}
                Los costos están por debajo del total presupuestado en la orden de trabajo, generando un ahorro.
              {% elif diferencia > 0 %}
                Los costos exceden el total presupuestado en la orden de trabajo.
              {% else %}
                Los costos coinciden exactamente con el total de la orden de trabajo.
              {% endif %}
            </p>
          </div>
        <footer class="footer">
            <p>
                Carrera 13A # 40 - 37 B/Primero de Mayo, Palmira - Colombia<br />
                Cel (+57) 311 616 7972 | Fijo (602) 287 2362<br />
                afh@afhmetalmecanico.com<br />
                www.afhmetalmecanico.com
            </p>
        </footer>
    </div>
</body>

</html>